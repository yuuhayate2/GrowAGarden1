local Players = game:GetService("Players")
local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui")
local SoundService = game:GetService("SoundService")

-- === Loading Screen
local loadingGui = Instance.new("ScreenGui", PlayerGui)
loadingGui.Name = "LoadingScreen"
loadingGui.ResetOnSpawn = false

local loadingFrame = Instance.new("Frame", loadingGui)
loadingFrame.Size = UDim2.new(1,0,1,0)
loadingFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
loadingFrame.BorderSizePixel = 0

local logo = Instance.new("TextLabel", loadingFrame)
logo.Size = UDim2.new(0,120,0,120)
logo.Position = UDim2.new(0.5,-60,0.4,-60)
logo.BackgroundTransparency = 1
logo.Text = "K"
logo.TextColor3 = Color3.fromRGB(255,50,50)
logo.Font = Enum.Font.GothamBlack
logo.TextScaled = true

task.spawn(function()
	local angle = 0
	while loadingFrame.Parent do
		local offset = 5 * math.sin(tick()*2)
		logo.Size = UDim2.new(0, 120+offset, 0, 120+offset)
		logo.Rotation = angle
		angle = (angle + 1) % 360
		task.wait(0.03)
	end
end)

local loadingText = Instance.new("TextLabel", loadingFrame)
loadingText.Size = UDim2.new(0,350,0,50)
loadingText.Position = UDim2.new(0.5,-175,0.6,0)
loadingText.BackgroundTransparency = 1
loadingText.TextColor3 = Color3.new(1,1,1)
loadingText.Font = Enum.Font.SourceSansBold
loadingText.TextSize = 24
loadingText.Text = "🔄 Generating Egg Predictor"

local running = true
task.spawn(function()
	while running do
		for i=0,3 do
			loadingText.Text = "🔄 Generating Egg Predictor" .. string.rep(".", i)
			task.wait(0.4)
		end
	end
end)

task.delay(5, function()
	if running then loadingText.Text = "✨ Almost ready..." end
end)

task.wait(10)
running = false

for i=0,1,0.05 do
	loadingFrame.BackgroundTransparency = i
	logo.TextTransparency = i
	loadingText.TextTransparency = i
	task.wait(0.03)
end

loadingGui:Destroy()

-- === Data Tables
local eggToPets = { ... } -- (copied unchanged from previous)
local petIcons = {
	Dog = "rbxassetid://12345", -- replace with actual icon IDs
	Bunny = "rbxassetid://12346",
	-- etc.
}

-- === GUI Setup
local gui = Instance.new("ScreenGui", PlayerGui)
gui.Name = "EggESP_UI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,240,0,160)
frame.Position = UDim2.new(0.01,0,0.35,0)
frame.BackgroundColor3 = Color3.fromRGB(35,35,35)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

-- Dark Mode toggle
local darkMode = true
local function updateTheme()
	if darkMode then
		frame.BackgroundColor3 = Color3.fromRGB(35,35,35)
	else
		frame.BackgroundColor3 = Color3.fromRGB(220,220,220)
	end
end
updateTheme()

local darkToggle = Instance.new("TextButton", frame)
darkToggle.Size = UDim2.new(0,80,0,20)
darkToggle.Position = UDim2.new(0,5,1,-25)
darkToggle.Text = "Toggle Dark"
darkToggle.Font = Enum.Font.SourceSans
darkToggle.TextSize = 14
darkToggle.BackgroundColor3 = Color3.fromRGB(80,80,80)
darkToggle.TextColor3 = Color3.new(1,1,1)
darkToggle.MouseButton1Click:Connect(function()
	darkMode = not darkMode
	updateTheme()
end)

-- Title
local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,-40,0,25)
title.Position = UDim2.new(0,5,0,0)
title.BackgroundTransparency = 1
title.Text = "Pet Predictor By Kuni"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18
title.TextColor3 = Color3.new(1,1,1)
title.TextXAlignment = Enum.TextXAlignment.Left

-- Buttons
local exitBtn = Instance.new("TextButton", frame)
exitBtn.Size, exitBtn.Position = UDim2.new(0,20,0,20), UDim2.new(1,-22,0,2)
exitBtn.Text, exitBtn.Font = "❌", Enum.Font.SourceSans
exitBtn.TextSize = 14
exitBtn.BackgroundColor3 = Color3.fromRGB(180,50,50)
exitBtn.TextColor3 = Color3.new(1,1,1)

local minBtn = Instance.new("TextButton", frame)
minBtn.Size, minBtn.Position = UDim2.new(0,20,0,20), UDim2.new(1,-44,0,2)
minBtn.Text, minBtn.Font = "–", Enum.Font.SourceSans
minBtn.TextSize = 18
minBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
minBtn.TextColor3 = Color3.new(1,1,1)

local minimizedIcon = Instance.new("TextButton", gui)
minimizedIcon.Size, minimizedIcon.Position = UDim2.new(0,120,0,30), UDim2.new(0,10,1,-40)
minimizedIcon.Text = "📦 Open Pet Predictor"
minimizedIcon.Visible = false
minimizedIcon.BackgroundColor3 = Color3.fromRGB(50,50,50)
minimizedIcon.TextColor3 = Color3.new(1,1,1)
minimizedIcon.Font = Enum.Font.SourceSans
minimizedIcon.TextSize = 14

-- Predict Button + Sound + RGB
local randomBtn = Instance.new("TextButton", frame)
randomBtn.Size = UDim2.new(0.9,0,0.5,0)
randomBtn.Position = UDim2.new(0.05,0,0.25,0)
randomBtn.Text = "Predict Pets"
randomBtn.Font, randomBtn.TextSize = Enum.Font.SourceSans, 16
randomBtn.BackgroundColor3 = Color3.fromRGB(80,130,255)
randomBtn.TextColor3 = Color3.new(1,1,1)

local clickSound = Instance.new("Sound", SoundService)
clickSound.SoundId = "rbxassetid://9118823102"; clickSound.Volume = 1

-- === ESP Logic/Animations
local espList = {}
local function clearESP()
	for _,gui in ipairs(espList) do
		if gui and gui.Parent then
			spawn(function()
				for i=1,0,-0.1 do
					gui.StudsOffset = gui.StudsOffset + Vector3.new(0,0.1,0)
					gui.ExtentSize = UDim2.new(0,100,0,40)
					task.wait(0.03)
				end
				gui:Destroy()
			end)
		end
	end
	espList = {}
end

local function createESP(petPart, petName, hatchable)
	local gui = Instance.new("BillboardGui", petPart)
	gui.Name ="EggESP"; gui.Size = UDim2.new(0,100,0,40)
	gui.StudsOffset = Vector3.new(0,1,0)
	gui.AlwaysOnTop = true

	local icon = Instance.new("ImageLabel", gui)
	icon.Size = UDim2.new(0,30,0,30)
	icon.Position = UDim2.new(0,0,0,0)
	icon.Image = petIcons[petName] or ""
	icon.BackgroundTransparency = 1

	local label = Instance.new("TextLabel", gui)
	label.Size = UDim2.new(1,-30,0.6,0); label.Position = UDim2.new(0.3,0,0,0)
	label.BackgroundTransparency = 1; label.Text = petName
	label.TextScaled, label.Font = true, Enum.Font.SourceSansBold
	label.TextColor3 = Color3.new(1,1,1)

	local status = Instance.new("TextLabel", gui)
	status.Size = UDim2.new(1,0,0.4,0); status.Position = UDim2.new(0,0,0.6,0)
	status.BackgroundTransparency = 1
	status.Text = hatchable and "✅ Hatchable" or "❌ Not Hatchable"
	status.TextScaled, status.Font = true, Enum.Font.SourceSans
	status.TextColor3 = hatchable and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)

	spawn(function()
		for i=0,1,0.1 do
			gui.StudsOffset = gui.StudsOffset:Lerp(Vector3.new(0,2.5,0), i)
			task.wait(0.03)
		end
	end)

	-- Particle effect
	local part = petPart
	local particle = Instance.new("ParticleEmitter", part)
	particle.Rate, particle.Lifetime = 15, NumberRange.new(0.5,1)
	particle.Speed, particle.Texture = NumberRange.new(1,2), "rbxassetid://296874871"
	game.Debris:AddItem(particle, 2)

	table.insert(espList, gui)
end

local function randomizeEggs()
	clearESP()
	for _,obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and eggToPets[obj.Name] then
			local part = obj:FindFirstChildWhichIsA("BasePart")
			if part then
				local pet = eggToPets[obj.Name][math.random(#eggToPets[obj.Name])]
				createESP(part, pet, math.random()>0.5)
			end
		end
	end
end

-- === RGB Button + Debounce
local debounce = false
randomBtn.MouseButton1Click:Connect(function()
	if debounce then return end
	debounce = true; clickSound:Play()
	local h=0; local rgbrun=true
	local rgbThread = task.spawn(function()
		while rgbrun do
			h = (h+0.01)%1
			randomBtn.BackgroundColor3 = Color3.fromHSV(h,1,1)
			task.wait(0.02)
		end
	end)
	randomizeEggs()
	task.wait(10)
	rgbrun=false; task.cancel(rgbThread)
	randomBtn.Text, randomBtn.BackgroundColor3, debounce = "Predict Pets", Color3.fromRGB(80,130,255), false
end)

-- === Buttons Logic
minBtn.MouseButton1Click:Connect(function()
	frame.Visible, minimizedIcon.Visible = false, true
end)
minimizedIcon.MouseButton1Click:Connect(function()
	frame.Visible, minimizedIcon.Visible = true, false
end)
exitBtn.MouseButton1Click:Connect(function()
	clearESP(); gui:Destroy()
end)
